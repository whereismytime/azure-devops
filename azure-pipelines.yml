# Azure DevOps YAML pipeline using self-hosted agent from 'MyHostedPool'

trigger:
  - main  # ğŸ” Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¿Ñ€Ğ¸ Ğ¿ÑƒÑˆĞµ Ğ² Ğ²ĞµÑ‚ĞºÑƒ main

pool:
  name: MyHostedPool    # ğŸŠâ€â™‚ï¸ ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿ÑƒĞ»Ğ° Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ²
  demands:
    - Agent.Name -equals ANDY  # ğŸ¯ Ğ¯Ğ²Ğ½Ğ¾ ÑƒĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ½Ğ° Ğ°Ğ³ĞµĞ½Ñ‚Ğ° ANDY

steps:
  - script: echo Hello from ANDY agent!
    displayName: 'ğŸ‘‹ Greeting step'

  - script: |
      echo ğŸ” Searching for .sln or .csproj...
      setlocal enabledelayedexpansion
      set "targetFile="
      for %%f in (*.sln) do (
        set "targetFile=%%f"
        goto :found
      )
      for /r %%f in (*.csproj) do (
        set "targetFile=%%f"
        goto :found
      )
      echo âŒ No .sln or .csproj file found!
      exit /b 1
      :found
      echo âœ… Found: !targetFile!
      dotnet build "!targetFile!" --configuration Release
    displayName: 'ğŸ”¨ Auto-detect & Build .NET project'

  - script: |
      echo ğŸ§ª Running tests...
      dotnet test --no-build
    displayName: 'âœ… Run unit tests'
